# Agentå‚æ•°ä¼ é€’è¯¦è§£

## ğŸ¯ **å›ç­”æ‚¨çš„é—®é¢˜**

**Q: ç›®å‰å¦‚æœæ˜¯äº¤ç»™Agentæ¥å¤„ç†çš„è¯ï¼Œæ„å›¾è¯†åˆ«åˆ†ç±»å™¨ä¼šä¼ é€’ä»€ä¹ˆæ ·çš„å‚æ•°ï¼Ÿ**

**A: ç»è¿‡ä¼˜åŒ–åï¼Œç³»ç»Ÿç°åœ¨ä¸ºAgentæä¾›ç»“æ„åŒ–çš„å¢å¼ºå‚æ•°ï¼ŒåŒ…å«6å¤§ç±»ä¿¡æ¯ï¼š**

---

## ğŸ“¦ **å®Œæ•´å‚æ•°ç»“æ„**

### **1ï¸âƒ£ æ„å›¾åˆ†æ (intent_analysis)**
```json
{
  "routing_path": "reference",        // è·¯ç”±è·¯å¾„ç±»å‹
  "confidence": 0.6,                  // ç½®ä¿¡åº¦ (0-1)
  "processing_time_ms": 0.22,         // å¤„ç†æ—¶é—´
  "rule_triggered": null,             // è§¦å‘çš„å…·ä½“è§„åˆ™
  "context_aware": false,             // æ˜¯å¦éœ€è¦ä¸Šä¸‹æ–‡
  "bypass_agent": null                // æ˜¯å¦ç»•è¿‡Agent
}
```

### **2ï¸âƒ£ å†…å®¹åˆ†æ (content_analysis)**
```json
{
  "matched_keywords": {               // åŒ¹é…çš„å…³é”®è¯è¯¦æƒ…
    "help_words": ["æ€ä¹ˆåŠ"],
    "medium_risk": ["æ§åˆ¶"],
    "romance_self": ["ç”·æœ‹å‹"]
  },
  "keyword_coverage": 1.0,            // å…³é”®è¯è¦†ç›–ç‡
  "text_complexity": "simple",        // æ–‡æœ¬å¤æ‚åº¦
  "text_length": 14,                  // æ–‡æœ¬é•¿åº¦
  "question_marks": 1,                // é—®å·æ•°é‡
  "exclamation_marks": 0              // æ„Ÿå¹å·æ•°é‡
}
```

### **3ï¸âƒ£ ä¸Šä¸‹æ–‡ä¿¡å· (context_signals)**
```json
{
  "risk_level": "medium",             // é£é™©ç­‰çº§
  "romance_context": {                // æ‹çˆ±ä¸Šä¸‹æ–‡
    "subject": "self",                // ä¸»ä½“ (self/other/unknown)
    "behaviors": [],                  // è¡Œä¸ºåˆ—è¡¨
    "emotions": []                    // æƒ…ç»ªåˆ—è¡¨
  },
  "help_intent": true,                // æ˜¯å¦æœ‰æ±‚åŠ©æ„å›¾
  "emotion_intensity": 0.1,           // æƒ…ç»ªå¼ºåº¦ (0-1)
  "matched_patterns": [               // åŒ¹é…çš„æ¨¡å¼
    "medium_risk", "self_romance", "help_seeking"
  ],
  "confidence_factors": {             // ç½®ä¿¡åº¦å› å­
    "risk_detection": 0.7,
    "romance_self": 0.8,
    "help_intent": 0.9
  }
}
```

### **4ï¸âƒ£ AgentæŒ‡å¯¼ (agent_guidance)**
```json
{
  "suggested_tools": ["talk_tool", "help_tool"],  // å»ºè®®å·¥å…·
  "reasoning": "æ£€æµ‹åˆ°mediumé£é™©ç­‰çº§çš„å¤æ‚æƒ…å†µ...",  // æ¨ç†è¯´æ˜
  "priority_aspects": [                           // ä¼˜å…ˆæ–¹é¢
    "é£é™©è¯„ä¼°", "æƒ…æ„Ÿæ”¯æŒ", "è‡ªæˆ‘ä¿æŠ¤æ„è¯†"
  ],
  "avoid_aspects": ["ç›´æ¥å»ºè®®åˆ†æ‰‹"],               // é¿å…æ–¹é¢
  "response_tone": "caring_cautious",             // å›åº”è¯­è°ƒ
  "safety_level": "alert"                        // å®‰å…¨çº§åˆ«
}
```

### **5ï¸âƒ£ è®°å¿†ä¸Šä¸‹æ–‡ (memory_context)**
```json
{
  "recent_topics": ["å·¥ä½œ", "å‹åŠ›"],     // æœ€è¿‘è¯é¢˜
  "user_emotional_state": "negative",   // ç”¨æˆ·æƒ…ç»ªçŠ¶æ€
  "conversation_flow": "seeking_help",   // å¯¹è¯æµç¨‹
  "context_continuity": true            // ä¸Šä¸‹æ–‡è¿ç»­æ€§
}
```

### **6ï¸âƒ£ æŠ€æœ¯å…ƒæ•°æ® (technical_meta)**
```json
{
  "router_version": "dual_layer_v2_enhanced",  // è·¯ç”±å™¨ç‰ˆæœ¬
  "fallback_reason": null,                     // å…œåº•åŸå› 
  "performance_stats": {                       // æ€§èƒ½ç»Ÿè®¡
    "token_saved": false,                      // æ˜¯å¦èŠ‚çœtoken
    "routing_efficiency": 0.7,                 // è·¯ç”±æ•ˆç‡
    "optimization_level": "medium"             // ä¼˜åŒ–çº§åˆ«
  },
  "debug_info": {                             // è°ƒè¯•ä¿¡æ¯
    "signals": ["risk_detection", "romance_self"]
  }
}
```

---

## ğŸ­ **ä¸¤ç§Agentè°ƒç”¨åœºæ™¯**

### **åœºæ™¯1: å‚è€ƒä¿¡å·æŒ‡å¯¼ (referenceè·¯ç”±)**
- **ä½•æ—¶è§¦å‘**: æ£€æµ‹åˆ°å¤æ‚æƒ…å†µä½†æœ‰æ˜ç¡®ä¿¡å·
- **ä¼ é€’å†…å®¹**: å®Œæ•´çš„6ç±»å‚æ•°
- **Agentè¡Œä¸º**: å‚è€ƒä¿¡å·å’ŒæŒ‡å¯¼è¿›è¡Œæ™ºèƒ½å†³ç­–
- **ç¤ºä¾‹**: "æˆ‘ç”·æœ‹å‹æ€»æ˜¯æ§åˆ¶æˆ‘" â†’ ä¸­ç­‰é£é™©+æ‹çˆ±ä¸Šä¸‹æ–‡+æ±‚åŠ©æ„å›¾

### **åœºæ™¯2: å…œåº•å¤„ç† (fallbackè·¯ç”±)**
- **ä½•æ—¶è§¦å‘**: æ— æ˜ç¡®æ¨¡å¼åŒ¹é…
- **ä¼ é€’å†…å®¹**: åŸºç¡€å‚æ•°+å…œåº•åŸå› 
- **Agentè¡Œä¸º**: é€šç”¨å¤„ç†é€»è¾‘
- **ç¤ºä¾‹**: "æ„Ÿæƒ…é—®é¢˜å¾ˆå¤æ‚" â†’ æ— æ˜ç¡®å…³é”®è¯åŒ¹é…

---

## ğŸš€ **Agentå¦‚ä½•ä½¿ç”¨è¿™äº›å‚æ•°**

### **é£é™©é˜²æŠ¤**
```python
# æ ¹æ®é£é™©ç­‰çº§è°ƒæ•´å®‰å…¨æªæ–½
risk = params['context_signals']['risk_level']
if risk == 'high':
    enable_emergency_protocols()
elif risk == 'medium':
    enable_caution_mode()
```

### **ä¸ªæ€§åŒ–å›åº”**
```python
# æ ¹æ®è¯­è°ƒå»ºè®®è°ƒæ•´å›åº”é£æ ¼
tone = params['agent_guidance']['response_tone']
if tone == 'caring_cautious':
    set_empathetic_mode()
elif tone == 'serious_supportive':
    set_professional_mode()
```

### **ç­–ç•¥æŒ‡å¯¼**
```python
# æ ¹æ®ä¼˜å…ˆæ–¹é¢è°ƒæ•´å›åº”é‡ç‚¹
priorities = params['agent_guidance']['priority_aspects']
if 'é£é™©è¯„ä¼°' in priorities:
    focus_on_safety_analysis()
if 'æƒ…æ„Ÿæ”¯æŒ' in priorities:
    provide_emotional_support()
```

### **ä¸Šä¸‹æ–‡è¿è´¯**
```python
# è€ƒè™‘å†å²è¯é¢˜ä¿æŒè¿è´¯æ€§
recent_topics = params['memory_context']['recent_topics']
if 'å·¥ä½œ' in recent_topics and 'å‹åŠ›' in recent_topics:
    acknowledge_work_stress_context()
```

---

## ğŸ“Š **å‚æ•°ä»·å€¼æ€»ç»“**

| å‚æ•°ç±»åˆ« | ä»·å€¼ | åº”ç”¨åœºæ™¯ |
|---------|------|----------|
| **æ„å›¾åˆ†æ** | ç†è§£å¤„ç†å¤æ‚åº¦å’Œç½®ä¿¡åº¦ | å†³å®šå›åº”ç¡®å®šæ€§ |
| **å†…å®¹åˆ†æ** | ç²¾ç¡®ç†è§£ç”¨æˆ·å…³æ³¨ç‚¹ | å®šåˆ¶å›åº”å†…å®¹ |
| **ä¸Šä¸‹æ–‡ä¿¡å·** | æƒ…å¢ƒæ„ŸçŸ¥å’Œé£é™©è¯„ä¼° | å®‰å…¨é˜²æŠ¤æªæ–½ |
| **AgentæŒ‡å¯¼** | å…·ä½“çš„ç­–ç•¥å»ºè®® | å›åº”ç­–ç•¥é€‰æ‹© |
| **è®°å¿†ä¸Šä¸‹æ–‡** | å†å²è¿è´¯æ€§ | ä¿æŒå¯¹è¯è‡ªç„¶ |
| **æŠ€æœ¯å…ƒæ•°æ®** | æ€§èƒ½å’Œè°ƒè¯•ä¿¡æ¯ | ç³»ç»Ÿä¼˜åŒ– |

---

## ğŸ¯ **æ ¸å¿ƒä¼˜åŠ¿**

1. **ğŸ” ç²¾å‡†ç†è§£**: é€šè¿‡å…³é”®è¯åŒ¹é…å’Œæ¨¡å¼è¯†åˆ«ï¼Œå‡†ç¡®ç†è§£ç”¨æˆ·æ„å›¾
2. **ğŸ›¡ï¸ å®‰å…¨é˜²æŠ¤**: é£é™©ç­‰çº§å’Œå®‰å…¨çº§åˆ«æŒ‡å¯¼ï¼Œç¡®ä¿ç”¨æˆ·å®‰å…¨
3. **ğŸ¨ ä¸ªæ€§åŒ–**: è¯­è°ƒå»ºè®®å’Œç­–ç•¥æŒ‡å¯¼ï¼Œæä¾›ä¸ªæ€§åŒ–å›åº”
4. **ğŸ”„ è¿è´¯æ€§**: å†å²è¯é¢˜å’Œæƒ…ç»ªçŠ¶æ€ï¼Œä¿æŒå¯¹è¯è¿è´¯
5. **âš¡ é«˜æ•ˆ**: è·¯ç”±æ•ˆç‡å’Œä¼˜åŒ–çº§åˆ«ï¼Œæå‡å¤„ç†æ•ˆç‡
6. **ğŸ”§ å¯è°ƒè¯•**: å®Œæ•´çš„æŠ€æœ¯å…ƒæ•°æ®ï¼Œä¾¿äºç³»ç»Ÿä¼˜åŒ–

**ğŸ’¡ æ€»ç»“**: ç°åœ¨çš„æ„å›¾è¯†åˆ«åˆ†ç±»å™¨ä¸å†åªæ˜¯ç®€å•çš„æ–‡æœ¬ä¼ é€’ï¼Œè€Œæ˜¯ä¸ºAgentæä¾›äº†ä¸€ä¸ªç»“æ„åŒ–ã€å…¨é¢çš„"ç”¨æˆ·ç”»åƒ+å¤„ç†æŒ‡å—"ï¼Œè®©Agentèƒ½å¤Ÿæ›´æ™ºèƒ½ã€æ›´å®‰å…¨ã€æ›´ä¸ªæ€§åŒ–åœ°å“åº”ç”¨æˆ·éœ€æ±‚ã€‚
